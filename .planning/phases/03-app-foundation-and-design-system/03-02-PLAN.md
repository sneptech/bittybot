---
phase: 03-app-foundation-and-design-system
plan: 02
type: execute
wave: 2
depends_on:
  - "03-01"
files_modified:
  - lib/core/theme/app_colors.dart
  - lib/core/theme/app_theme.dart
  - lib/core/theme/app_text_theme.dart
autonomous: true
requirements:
  - UIUX-01
  - UIUX-02
  - UIUX-04
  - UIUX-05

must_haves:
  truths:
    - "App displays a near-black green background with forest green accents and lime/yellow-green highlights"
    - "White text on all green surfaces passes WCAG AA contrast (4.5:1 for normal text, 3:1 for large text)"
    - "Body text renders at minimum 16sp baseline"
    - "All Material tap targets are at least 48x48dp (MaterialTapTargetSize.padded)"
    - "Typography uses Lato as primary font with system font fallbacks for non-Latin scripts"
  artifacts:
    - path: "lib/core/theme/app_colors.dart"
      provides: "Brand color palette constants"
      contains: "AppColors"
    - path: "lib/core/theme/app_theme.dart"
      provides: "Dark ThemeData with manual ColorScheme"
      contains: "buildDarkTheme"
    - path: "lib/core/theme/app_text_theme.dart"
      provides: "Lato-based TextTheme with 16sp body minimum"
      contains: "buildTextTheme"
  key_links:
    - from: "lib/core/theme/app_theme.dart"
      to: "lib/core/theme/app_colors.dart"
      via: "imports AppColors for ColorScheme construction"
      pattern: "import.*app_colors"
    - from: "lib/core/theme/app_theme.dart"
      to: "lib/core/theme/app_text_theme.dart"
      via: "imports buildTextTheme for ThemeData.textTheme"
      pattern: "import.*app_text_theme"
---

<objective>
Build the complete dark theme system: color palette with WCAG-validated greens, Material 3 ThemeData with manual ColorScheme (not fromSeed), and Lato-based text theme with 16sp minimum body text and script fallbacks.

Purpose: Every screen in BittyBot inherits this theme. Getting the palette, contrast ratios, and typography right at this stage prevents rework in all subsequent phases.

Output: Three theme files (app_colors.dart, app_theme.dart, app_text_theme.dart) that produce a dark, Cohere-inspired green aesthetic with accessible contrast and legible typography.
</objective>

<execution_context>
@/home/max/.claude/mowism/workflows/execute-plan.md
@/home/max/.claude/mowism/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-app-foundation-and-design-system/03-RESEARCH.md
@.planning/phases/03-app-foundation-and-design-system/03-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create color palette with WCAG-validated hex values</name>
  <files>
    lib/core/theme/app_colors.dart
  </files>
  <action>
    Create `lib/core/theme/app_colors.dart` as an abstract final class with const Color values.

    The palette (per locked user decisions):
    - Background: very dark green (near-black green). Start with `#0A1A0A` (~16.3:1 contrast with white — excellent).
    - Surface containers (cards, elevated surfaces): slightly lighter dark green. Use `#0F2B0F` or similar.
    - Primary (buttons, interactive accents): forest green. The research warns that standard #228B22 gives only ~3.5:1 with white — FAILS WCAG AA. Use a darker forest green. Start with `#1B5E20` (Material green[900]) which gives ~5.5:1 — passes AA. If this looks too dark, try `#2E7D32` (green[800]) at ~4.0:1 — only passes for large text. For normal text buttons with white labels, the forest green MUST be dark enough for 4.5:1.
    - Input fields / user message bubbles: forest green (same primary or slightly darker variant like `#1A4D1A`).
    - Lime/yellow-green (borders, highlights, logo accents): `#8BC34A` (Material light green). On the near-black background this gives ~8.5:1 — excellent contrast.
    - Text: `#FFFFFF` throughout.
    - Muted text / icons: `#B0D0B0` (soft green-tinted gray).
    - Error: `#CF6679` (standard Material dark error).

    CRITICAL: Before finalizing, compute WCAG contrast ratios for every surface/text pair:
    - White (#FFFFFF) on background (#0A1A0A): Must be >= 4.5:1 (will be ~16:1 — excellent)
    - White (#FFFFFF) on primary forest green: Must be >= 4.5:1 for button text
    - White (#FFFFFF) on input field green: Must be >= 4.5:1 for normal text, >= 3:1 for large text (18sp bold or 24sp)
    - Lime (#8BC34A) on background (#0A1A0A): Must be >= 3:1 for decorative borders (non-text OK)

    Use the relative luminance formula: L = 0.2126*R + 0.7152*G + 0.0722*B (with linearized sRGB).
    Contrast ratio = (L1 + 0.05) / (L2 + 0.05) where L1 > L2.

    Document the contrast ratios as comments in the file.

    ```dart
    import 'package:flutter/material.dart';

    /// BittyBot brand color palette — Cohere Tiny Aya inspired.
    /// All surface/text pairs are WCAG AA compliant.
    abstract final class AppColors {
      // Backgrounds
      static const surface = Color(0xFF0A1A0A);           // Near-black green
      static const surfaceContainer = Color(0xFF0F2B0F);  // Slightly lighter (cards)

      // Primary (forest green)
      static const primary = Color(0xFF1B5E20);           // Buttons, accents (~5.5:1 with white)
      static const primaryContainer = Color(0xFF0F3D0F);  // Input fields, bubbles

      // Secondary (lime/yellow-green)
      static const secondary = Color(0xFF8BC34A);         // Borders, highlights
      static const onSecondary = Color(0xFF000000);       // Text on lime bg

      // Text
      static const onSurface = Color(0xFFFFFFFF);         // Primary text
      static const onSurfaceVariant = Color(0xFFB0D0B0);  // Muted text, icons
      static const onPrimary = Color(0xFFFFFFFF);         // Text on forest green

      // Semantic
      static const error = Color(0xFFCF6679);
      static const onError = Color(0xFFFFFFFF);
    }
    ```

    Adjust hex values as needed to find the sweet spot between "forest green aesthetic" and "WCAG AA compliance." Darker is safer for contrast.
  </action>
  <verify>
    Verify each surface/text contrast ratio is documented in code comments.
    Run `flutter analyze` — no errors.
    Key check: onPrimary (#FFFFFF) on primary (forest green) >= 4.5:1.
  </verify>
  <done>
    Color palette is defined with all hex values documented and WCAG AA contrast ratios verified for every surface/text pairing.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build dark ThemeData and Lato text theme</name>
  <files>
    lib/core/theme/app_theme.dart
    lib/core/theme/app_text_theme.dart
  </files>
  <action>
    Create `lib/core/theme/app_text_theme.dart`:

    Build a function `TextTheme buildTextTheme()` that:
    1. Starts with `GoogleFonts.latoTextTheme()` as the base
    2. Overrides `bodyMedium` to 16sp (UIUX-05 — Flutter default is 14sp)
    3. Overrides `bodyLarge` to 18sp
    4. Keeps `bodySmall` at 14sp (acceptable for captions/metadata)
    5. Adds `fontFamilyFallback` to all text styles for non-Latin script support:
       `['Noto Sans Arabic', 'Noto Sans Thai', 'Noto Sans CJK SC', 'Noto Sans CJK TC', 'Noto Sans JP', 'Noto Sans KR']`
       (These are advisory — present on Android; on iOS, Flutter falls through to system fonts automatically)
    6. Sets color to white for all text styles (since this is a dark-only theme)

    Create `lib/core/theme/app_theme.dart`:

    Build a function `ThemeData buildDarkTheme()` that:
    1. Sets `brightness: Brightness.dark`
    2. Constructs `ColorScheme` manually using full constructor (NOT `fromSeed`):
       - Map all `AppColors` values to appropriate ColorScheme roles
       - `brightness: Brightness.dark`
       - `surface`, `onSurface`, `primary`, `onPrimary`, `primaryContainer`, `onPrimaryContainer`, `secondary`, `onSecondary`, `secondaryContainer`, `onSecondaryContainer`, `error`, `onError`, `outline` (lime for borders)
    3. Sets `textTheme: buildTextTheme()`
    4. Sets `scaffoldBackgroundColor: AppColors.surface` (explicit, even if ColorScheme handles it)
    5. Sets `materialTapTargetSize: MaterialTapTargetSize.padded` (UIUX-04 — ensures 48x48dp minimum; this is the Flutter mobile default but set explicitly for safety)
    6. Configures component themes for consistent look:
       - `AppBarTheme`: backgroundColor = surface, foregroundColor = white, elevation = 0 (clean/minimal per UIUX-02)
       - `ElevatedButtonTheme`: forest green background, white text, minimum 48dp height
       - `InputDecorationTheme`: filled = true, fillColor = primaryContainer, border color = lime/secondary
       - `SnackBarTheme`: background = surfaceContainer, text = white
       - `CardTheme`: color = surfaceContainer, elevation = 0 (flat, minimal)
    7. Does NOT set `useMaterial3: true` (it's the default in Flutter 3.16+ — setting it is redundant)
    8. Does NOT set any `textScaler` cap (per locked decision: respect system font size fully)

    Import `app_colors.dart` and `app_text_theme.dart`. Use `google_fonts` package for `GoogleFonts.latoTextTheme()`.
  </action>
  <verify>
    Run `flutter analyze` — no errors in theme files.
    Verify `buildDarkTheme()` returns a valid `ThemeData` (write a simple test or confirm via analyzer).
    Confirm `MaterialTapTargetSize.padded` is set.
    Confirm no `textScaleFactor` cap or `MediaQuery.withClampedTextScaling`.
    Confirm `ColorScheme` uses full manual constructor, not `fromSeed`.
  </verify>
  <done>
    Dark theme with Cohere-inspired green palette renders correctly. Body text is 16sp minimum. Tap targets are 48x48dp. Typography uses Lato with non-Latin fallbacks. No light theme exists.
  </done>
</task>

</tasks>

<verification>
1. `flutter analyze` passes with zero errors across all theme files
2. `AppColors` class exists with documented WCAG contrast ratios
3. `buildDarkTheme()` uses manual `ColorScheme` constructor (grep for `ColorScheme(` — not `ColorScheme.fromSeed`)
4. `bodyMedium.fontSize` is 16 (not the Flutter default 14)
5. `materialTapTargetSize` is `MaterialTapTargetSize.padded`
6. No `textScaleFactor` cap anywhere in the codebase
7. `GoogleFonts.latoTextTheme()` is used as the base text theme
</verification>

<success_criteria>
The dark theme system produces a visually correct Cohere-inspired green palette with white text on dark backgrounds, forest green accents, and lime highlights. All surface/text pairs pass WCAG AA contrast. Body text is 16sp minimum. Lato is the primary font with script fallbacks. Tap targets are explicitly 48x48dp.
</success_criteria>

<output>
After completion, create `.planning/phases/03-app-foundation-and-design-system/03-02-SUMMARY.md`
</output>
