---
phase: 05-translation-ui
plan: "04"
type: execute
wave: 4
depends_on:
  - "05-03"
files_modified: []
autonomous: false
requirements:
  - TRNS-01
  - TRNS-02
  - TRNS-03
  - TRNS-04
  - TRNS-05

must_haves:
  truths:
    - "User can type text and receive a streaming translation in the target language"
    - "Language picker lists all 66 supported languages and user can select target independently"
    - "Source language is auto-detected (no source selector or swap button needed)"
    - "Long-press on translation bubble copies to clipboard with visual feedback"
    - "After app close and reopen, the last-used target language is pre-selected"
  artifacts: []
  key_links: []
---

<objective>
Visual and functional verification of the complete Phase 5 Translation UI on a device or emulator. Confirm all 5 success criteria from the ROADMAP are met.

Purpose: Human eyes verify that the chat-style interface looks correct, animations are smooth, the language picker is usable, clipboard copy works, and language persistence survives app restart.

Output: Verification results — either approval or a list of issues to fix.
</objective>

<execution_context>
@~/.claude/mowism/workflows/execute-plan.md
@~/.claude/mowism/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-translation-ui/05-CONTEXT.md
@.planning/phases/05-translation-ui/05-01-SUMMARY.md
@.planning/phases/05-translation-ui/05-02-SUMMARY.md
@.planning/phases/05-translation-ui/05-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build and launch app for verification</name>
  <files></files>
  <action>
Run static analysis and attempt to build the app:

```bash
cd /home/max/git/bittybot
/home/max/Android/flutter/bin/flutter analyze
/home/max/Android/flutter/bin/flutter build apk --debug 2>&1 | tail -20
```

If analysis or build fails, fix any compile errors before proceeding to human verification.

Note: The model (libmtmd.so) may not be available, so the app might not complete inference. That's OK for UI verification — we're checking the UI elements, layout, animations, and navigation, not end-to-end translation (which is deferred to Phase 6 when both Translation and Chat UI are built and the full pipeline can be tested).
  </action>
  <verify>
`flutter analyze` reports no errors. `flutter build apk --debug` completes without compile errors.
  </verify>
  <done>
App compiles successfully and is ready for visual verification.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Human verification of Phase 5 Translation UI</name>
  <files></files>
  <action>
Present the verification checklist to the user. The user runs `flutter run` on a connected device or emulator and tests all 7 categories below.

**What was built:**
Phase 5 Translation UI — complete translation screen with:
1. Bottom navigation bar (Translate + Chat tabs)
2. Chat-style bubble interface with right-aligned user bubbles and left-aligned translation bubbles
3. Multi-line expandable input bar with send/stop button toggle
4. iMessage-style typing indicator (pulsing dots)
5. Language picker bottom sheet (66 languages, 3-column grid, flags, search, popular, recent)
6. Long-press copy on translation bubbles
7. Target language persistence across app restarts
8. Context-full banner and new session button
9. Word-level batching for streaming display

**How to verify:**

**Test 1 — Navigation Shell (TRNS-01 prerequisite):**
1. App launches and shows bottom navigation with "Translate" and "Chat" tabs
2. Translate tab is active by default
3. Tapping Chat tab shows placeholder, tapping Translate returns to translation screen
4. Translation state is preserved when switching tabs (IndexedStack)

**Test 2 — Translation Input and Streaming (TRNS-01):**
1. Empty state shows centered "Type something to translate" prompt
2. Tapping the input bar brings up the keyboard
3. Type a multi-line message — input field grows (up to 6 lines)
4. Send button is visible and enabled when text is present
5. Tap Send — user message appears as right-aligned bubble
6. If model is available: typing indicator (pulsing dots) appears, then streaming translation appears word-by-word in a left-aligned bubble with the target language tag
7. If model is NOT available: input is disabled (acceptable — model loading is separate)

**Test 3 — Language Picker (TRNS-02):**
1. Tap the target language button in the top bar
2. Bottom sheet slides up with drag handle, search bar, and language grid
3. Recent languages section appears if languages have been used before
4. Popular languages (10) are visible at the top
5. Scroll down to see all 66 languages in a 3-column grid with flag icons
6. Type "span" in search → finds Spanish; type "esp" → also finds Spanish/Español
7. Select a language → picker closes, target language updates in the top bar

**Test 4 — Auto-detect / No Swap (TRNS-03):**
1. Confirm there is NO source language selector
2. Confirm there is NO swap button
3. The model auto-detects input language (verified by sending text in different languages)

**Test 5 — Copy to Clipboard (TRNS-04):**
1. Long-press on a translation (assistant) bubble
2. "Copy translation" option appears in a bottom sheet menu
3. Tap it → "Copied" snackbar appears briefly
4. Paste elsewhere to confirm clipboard contains the translation text
5. Also test long-press copy on user bubbles

**Test 6 — Language Persistence (TRNS-05):**
1. Select a non-default language (e.g., French)
2. Force-close the app completely
3. Reopen the app → French should be pre-selected as the target language

**Test 7 — Edge Cases:**
1. Type 500+ characters → character limit warning appears
2. Start a translation, tap stop → partial output is preserved
3. Tap "New session" button → conversation clears, target language remains
4. If context-full banner appears, "New session" clears it
  </action>
  <verify>
User reports "approved" or describes issues found during testing.
  </verify>
  <done>
All 7 test categories pass. TRNS-01 through TRNS-05 requirements are satisfied. Phase 5 Translation UI is complete.
  </done>
</task>

</tasks>

<verification>
Human verification of the complete Phase 5 Translation UI against all ROADMAP success criteria.
</verification>

<success_criteria>
- All 7 test categories pass visual and functional verification
- App compiles and runs without crashes
- UI matches the chat-style interface specified in CONTEXT.md
- All TRNS-01 through TRNS-05 requirements are satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/05-translation-ui/05-04-SUMMARY.md`
</output>
